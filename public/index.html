<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BART Experiment</title>
    <!-- <script src="https://unpkg.com/jspsych@8.0.0"></script>
    <script src="https://unpkg.com/@jspsych/plugin-html-keyboard-response@2.0.0"></script>
    <script src="https://unpkg.com/@jspsych/plugin-html-button-response@2.0.0"></script>
    <script src="https://unpkg.com/@jspsych/plugin-html-slider-response@2.0.0"></script> -->

    <script type="text/javascript" src="js/jspsych-6.0.5/jspsych.js"></script>

    <script src="js/jspsych-6.0.5/plugins/jspsych-html-keyboard-response.js"></script>
    <script src="js/jspsych-6.0.5/plugins/jspsych-html-button-response.js"></script>
    <script src="js/jspsych-6.0.5/plugins/jspsych-html-slider-response.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f5f5f5;
        }
        .balloon-container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .balloon {
            width: 50px;
            height: 70px;
            background-color: #ff6347;
            border-radius: 50%;
            margin-bottom: 20px;
            transition: all 0.1s ease-in-out;
        }
        .score-board {
            font-size: 18px;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <script>
        

        const trialCount = 10; // Number of trials
        let totalScore = 0;

        // Instructions
        const instructions = {
            type: 'html-keyboard-response',
            stimulus: `
                <h2>Balloon Analogue Risk Task (BART)</h2>
                <p>In this task, you will be presented with a series of balloons. Your goal is to inflate each balloon as much as you want by pressing the "Inflate" button. The more you inflate the balloon, the more points you earn. However, if the balloon pops, you lose the points for that trial.</p>
                <p>You can click "Collect" to save the points you've earned and proceed to the next balloon.</p>
                <p>Press any key to start the experiment.</p>
            `
        };

        // Balloon Trial
        const createBalloonTrial = () => {
            let balloonSize = 50;
            let pumps = 0;
            const maxPumps = Math.floor(Math.random() * 32) + 1; // Randomize max pumps between 1 and 32

            return {
                type: 'html-button-response',
                stimulus: `
                    <div class="balloon-container">
                        <div class="balloon" id="balloon" style="width:${balloonSize}px; height:${balloonSize * 1.4}px;"></div>
                        <button id="inflateButton">Inflate</button>
                        <button id="collectButton">Collect</button>
                        <div class="score-board">Current Score: ${totalScore}</div>
                    </div>
                `,
                choices: [], // No choices needed, we're using custom buttons
                on_load: () => {
                    const balloon = document.getElementById('balloon');
                    const inflateButton = document.getElementById('inflateButton');
                    const collectButton = document.getElementById('collectButton');

                    inflateButton.addEventListener('click', () => {
                        pumps++;
                        if (pumps < maxPumps) {
                            balloonSize += 5;
                            balloon.style.width = `${balloonSize}px`;
                            balloon.style.height = `${balloonSize * 1.4}px`;
                        } else {
                            // Balloon pops
                            balloon.style.backgroundColor = 'transparent';
                            balloon.style.border = '2px dashed #ff6347';
                            inflateButton.disabled = true;
                            collectButton.disabled = true;
                            setTimeout(() => jsPsych.finishTrial({
                                pumps: pumps,
                                popped: true,
                                points: 0
                            }), 1000);
                        }
                    });

                    collectButton.addEventListener('click', () => {
                        const points = pumps;
                        totalScore += points;
                        jsPsych.finishTrial({
                            pumps: pumps,
                            popped: false,
                            points: points
                        });
                    });
                }
            };
        };

        // Create trials
        const trials = [];
        for (let i = 0; i < trialCount; i++) {
            trials.push(createBalloonTrial());
        }

        // Debrief
        const debrief = {
            type: 'html-keyboard-response',
            stimulus: function() {
                return `
                    <h2>Experiment Complete</h2>
                    <p>Your total score is: ${totalScore}</p>
                    <p>Thank you for participating!</p>
                    <p>Press any key to end the experiment.</p>
                `;
            }
        };

        // Experiment timeline
        const timeline = [instructions,...trials, debrief];

        jsPsych.init({timeline:timeline});
    </script>
</body>
</html>
